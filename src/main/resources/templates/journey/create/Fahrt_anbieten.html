<!DOCTYPE html>
<html lang="de"
xmlns:th="http://www.thymeleaf.org">
    <head>
      <title>Fahrt_anbieten</title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
      
      <style>
      
          .container1{
            
              position: relative;
              margin-left: 150px;
              margin-right: 150px;
              
          }
          
          .container2{
              
              position: absolute;
              margin-left: 10px;
              width: 40%;
              margin-top: -25px;
          }
          
          .container3{
              
              position: absolute;
              margin-top: 450px;
              margin-left: 10px;
              width: 40%;
          }
          
          .container4{
              
              position: absolute;
              margin-left: 400px;
              width: 40%;
              margin-top: -25px;
              width: 30%;
          }

        .container5{

            position: absolute;
            margin-left: 18px;
            margin-top: 340px;
        }
          
           #logo{
              
             width:130px;
             height:50px;
             margin-top: 5px;
               
          }
          
          .navbar{
              
              margin-top: 10px;
              
          }
          
          #map {
              
              height: 100%;
              float: right;
              margin-right: 100px;
              border: solid black;
              margin-top: 20px;
              position: fixed;
              
          }
    
          .input{
              
              border-radius: 10px;
              
          }
          
          .form-control{
              
              width: 100%;
              border-radius:10px;
              
          }
          
          #departuredat{
              
              border-radius: 10px;
              width: 130px;
              margin-left:8px;
          }

            #departuretime{

                border-radius: 10px;
                width: 100px;
                margin-left:8px;
            }
          
          #arrivaldat{
              
              border-radius: 10px;
              width: 130px;
              margin-left: 8px;
          }

          #arrivaltime{

              border-radius:10px;
              width: 100px;
              margin-left: 8px;
          }

          #repeat{

              border-radius: 10px;
              height: 25px;
              margin-left: 8px;
          }

          .col-md-3{

              margin-left: 8px;
          }

          .btn{

              margin-bottom: 10px;
              border-radius: 10px;
              margin-left: 8px;
          }

          label{

              margin-left: 8px;
          }

          .dropdown{

              float:right;

          }
      
      </style>
      
      <link type="text/css" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script>
              var userId;
              var places = {};
              var autocompletes = {};
              var journey = {};
              var repeat = {};
              var car = {};

              function fillParam(){

                          /*<![CDATA[*/

                              userId = [[${user.id}]]

                          /*]]>*/
              }

              function initAutocomplete() {

                  var directionsService = new google.maps.DirectionsService;
                  var directionsDisplay = new google.maps.DirectionsRenderer;
                  var map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 5,
                    center: {lat: 51.133481, lng: 10.018343},
                    streetViewControl: false,
                    fullscreenControl: false,
                    mapTypeControlOptions: { mapTypeIds: [] },
                    styles: [
                              {
                                "elementType": "geometry",
                                "stylers": [
                                  {
                                    "color": "#ebe3cd"
                                  }
                                ]
                              },
                              {
                                "elementType": "labels.text.fill",
                                "stylers": [
                                  {
                                    "color": "#523735"
                                  }
                                ]
                              },
                              {
                                "elementType": "labels.text.stroke",
                                "stylers": [
                                  {
                                    "color": "#f5f1e6"
                                  }
                                ]
                              },
                              {
                                "featureType": "administrative",
                                "elementType": "geometry.stroke",
                                "stylers": [
                                  {
                                    "color": "#c9b2a6"
                                  }
                                ]
                              },
                              {
                                "featureType": "administrative.land_parcel",
                                "elementType": "geometry.stroke",
                                "stylers": [
                                  {
                                    "color": "#dcd2be"
                                  }
                                ]
                              },
                              {
                                "featureType": "administrative.land_parcel",
                                "elementType": "labels.text.fill",
                                "stylers": [
                                  {
                                    "color": "#ae9e90"
                                  }
                                ]
                              },
                              {
                                "featureType": "landscape.natural",
                                "elementType": "geometry",
                                "stylers": [
                                  {
                                    "color": "#dfd2ae"
                                  }
                                ]
                              },
                              {
                                "featureType": "poi",
                                "elementType": "geometry",
                                "stylers": [
                                  {
                                    "color": "#dfd2ae"
                                  }
                                ]
                              },
                              {
                                "featureType": "poi",
                                "elementType": "labels.text.fill",
                                "stylers": [
                                  {
                                    "color": "#93817c"
                                  }
                                ]
                              },
                              {
                                "featureType": "poi.park",
                                "elementType": "geometry.fill",
                                "stylers": [
                                  {
                                    "color": "#a5b076"
                                  }
                                ]
                              },
                              {
                                "featureType": "poi.park",
                                "elementType": "labels.text.fill",
                                "stylers": [
                                  {
                                    "color": "#447530"
                                  }
                                ]
                              },
                              {
                                "featureType": "road",
                                "elementType": "geometry",
                                "stylers": [
                                  {
                                    "color": "#f5f1e6"
                                  }
                                ]
                              },
                              {
                                "featureType": "road.arterial",
                                "elementType": "geometry",
                                "stylers": [
                                  {
                                    "color": "#fdfcf8"
                                  }
                                ]
                              },
                              {
                                "featureType": "road.highway",
                                "elementType": "geometry",
                                "stylers": [
                                  {
                                    "color": "#f8c967"
                                  }
                                ]
                              },
                              {
                                "featureType": "road.highway",
                                "elementType": "geometry.stroke",
                                "stylers": [
                                  {
                                    "color": "#e9bc62"
                                  }
                                ]
                              },
                              {
                                "featureType": "road.highway.controlled_access",
                                "elementType": "geometry",
                                "stylers": [
                                  {
                                    "color": "#e98d58"
                                  }
                                ]
                              },
                              {
                                "featureType": "road.highway.controlled_access",
                                "elementType": "geometry.stroke",
                                "stylers": [
                                  {
                                    "color": "#db8555"
                                  }
                                ]
                              },
                              {
                                "featureType": "road.local",
                                "elementType": "labels.text.fill",
                                "stylers": [
                                  {
                                    "color": "#806b63"
                                  }
                                ]
                              },
                              {
                                "featureType": "transit.line",
                                "elementType": "geometry",
                                "stylers": [
                                  {
                                    "color": "#dfd2ae"
                                  }
                                ]
                              },
                              {
                                "featureType": "transit.line",
                                "elementType": "labels.text.fill",
                                "stylers": [
                                  {
                                    "color": "#8f7d77"
                                  }
                                ]
                              },
                              {
                                "featureType": "transit.line",
                                "elementType": "labels.text.stroke",
                                "stylers": [
                                  {
                                    "color": "#ebe3cd"
                                  }
                                ]
                              },
                              {
                                "featureType": "transit.station",
                                "elementType": "geometry",
                                "stylers": [
                                  {
                                    "color": "#dfd2ae"
                                  }
                                ]
                              },
                              {
                                "featureType": "water",
                                "elementType": "geometry.fill",
                                "stylers": [
                                  {
                                    "color": "#b9d3c2"
                                  }
                                ]
                              },
                              {
                                "featureType": "water",
                                "elementType": "labels.text.fill",
                                "stylers": [
                                  {
                                    "color": "#92998d"
                                  }
                                ]
                              }
                            ]
                  });
                  directionsDisplay.setMap(map);

                var inputs = document.getElementsByClassName('input');

                var options = {
                  componentRestrictions: {country: 'de'}
                };

                function getRoute () {
                  // Get the place details from the autocomplete object.
                  var place = autocompletes[this.inputId].getPlace();

                  places[this.inputId] = place;

                  if (places.destination && places.origin){
                      var waypoints = [];

                      Object.keys(places).filter(key => (key !== 'destination' && key !== 'origin')).map(key => {
                          waypoints.push({
                            location: getLatLng(places[key]),
                            stopover: true
                          })
                      });


                      directionsService.route({
                          origin: getLatLng(places.origin),
                          destination: getLatLng(places.destination),
                          waypoints: waypoints,
                          optimizeWaypoints: false,
                          travelMode: 'DRIVING'
                        }, function(response, status) {
                          if (status === 'OK') {
                            journey.route = JSON.stringify(response)
                            journey.legs = JSON.stringify(response.routes[0].legs);
                            directionsDisplay.setDirections(response);
                          } else {
                            window.alert('Directions request failed due to ' + status);
                          }
                        });
                  }

                };


                for (var i = 0; i < inputs.length; i++) {
                  var autocomplete = new google.maps.places.Autocomplete(inputs[i], options);
                  autocomplete.inputId = inputs[i].id;
                  autocomplete.addListener('place_changed', getRoute);
                  autocompletes[autocomplete.inputId] = autocomplete;
                }

              }

              function getLatLng(place) {
                  var lat = place.geometry.location.lat();
                  var lng = place.geometry.location.lng();
                  var LatLng = new google.maps.LatLng(lat, lng);
                  return LatLng;
              }

              function saveJourney(){

                  /*<![CDATA[*/

                  userId = [[${user.id}]]

                  /*]]>*/

                  car.colour = $("#color").val();
                  car.licence = $("#licence").val();
                  car.type = $("#type").val();
                  repeat.id = $("#repeat").val();
                journey.seats = $("#seats").val();
                journey.bags = $("#bags").val();
                journey.priceKm = $("#priceKm").val();
                journey.priceBag = $("#priceBag").val();
                journey.departureDate = $("#departuredat").val();
                journey.arrivalDate = $("#arrivaldat").val();
                journey.departureTime = $("#departuretime").val();
                journey.arrivalTime = $("#arrivaltime").val();
                journey.origin = $("#origin").val();
                journey.destination = $("#destination").val();
                journey.repeat = repeat;
                journey.car = car;

                console.log(journey);

                $.ajax({
                    url: "/journey/create",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(journey),
                    success: function(data, status){
                    if(data){
                        window.location.href="/profile/show/profile?id="+userId+"#offered";
                        }
                    }.bind(this),
                    error: function(xhr, error) {
                      console.log(error);
                    }
                });
              };

            window.onload.fillParam;
            </script>
      
      </head>
  <body>
      
      <div class="container1">
          
          <nav class="navbar navbar-expand-md navbar-dark bg-dark" role="navigation">
  <div class="container-fluid">
    <!-- Titel und Schalter werden für eine bessere mobile Ansicht zusammengefasst -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Navigation ein-/ausblenden</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
     <a href="/" class="navbar-left"><img id="logo" th:src="@{/images/logo.png}"/></a>
    </div>

    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="/"><span class="glyphicon glyphicon-search" aria-hidden="true"></span> Suche</a></li>
        <li><a href="/journey/create"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Fahrt anbieten</a></li>
        <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Menü <span class="caret"></span></a>
          <ul class="dropdown-menu navbar-right">
            <li><a th:href="@{'/profile/show/profile?id='+${user.id}}+'#offered'"><span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span>   Angebotene Fahrten</a></li>
            <li><a th:href="@{'/profile/show/profile?id='+${user.id}}+'#booked'"><span class="glyphicon glyphicon-barcode" aria-hidden="true"></span>   Gebuchte Fahrten</a></li>
            <li role="separator" class="divider"></li>
            <li><a th:href="@{'/profile/show/profile?id='+${user.id}}+'#profil'"><span class="glyphicon glyphicon-user" aria-hidden="true"></span>   Profil</a></li>
            <li><a th:href="@{'/profile/show/profile?id='+${user.id}}+'#balance'"><span class="glyphicon glyphicon-piggy-bank" aria-hidden="true"></span>   Verfügbares Guthaben</a></li>
            <li><a th:href="@{'/profile/show/profile?id='+${user.id}}+'#rating'"><span class="glyphicon glyphicon-star" aria-hidden="true"></span>   Bewertung</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="/logout"><span class="glyphicon glyphicon-home" aria-hidden="true"></span>   Ausloggen</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
  </nav>
</div>
      <hr>
    <div class="container2">
    <h3 style="margin-left: -8px;">Routenplanung:</h3>
        <div class="form-group">
        <label for="Startpunkt">Startpunkt</label>
        <input style="width: 300px;" type="text" class="input form-control" id="origin" required placeholder="Startpunkt">
        </div>
        <div class="form-group">
        <label for="Startpunkt">Zwischenstop 1</label>
        <input style="width: 300px;" type="text" class="input form-control" id="stop1" placeholder="Zwischenstop 1">
        </div>
        <div class="form-group">
        <label for="Startpunkt">Zwischenstop 2</label>
        <input style="width: 300px;" type="text" class="input form-control" id="stop2" placeholder="Zwischenstop 2">
        </div>
        <div class="form-group">
        <label for="Startpunkt">Endziel</label>
        <input style="width: 300px;" type="text" class="input form-control" id="destination" required placeholder="Endziel">
        </div>
    </div>
      
    <div id="map" style="margin-left: 10px; height: 450px; width: 450px"></div>
      
    <div class="container4">
    <h3>Zeitplanung:</h3>

        <div class="row">

        <div class="col-md-12">
        <div class ="form-group">
        <label for="depdatdat">Datum der Abfahrt</label>
        <input style="margin-top: 25px;" type="date" id="departuredat" required class="form-inline"/>
        </div>
        </div>

        <div class="col-md-12">
        <div class="form-group">
        <label for="depdattime">Zeitpunkt der Abfahrt</label>
        <input style="margin-top: 33px;" type="time" id="departuretime" required class="form-inline"/>
        </div>
        </div>

        <div class="row">

        <div style="margin-left: 15px;" class="col-md-12">
        <div class="form-group">
        <label for="arrdatdat">Datum der Ankunft</label>
        <input style="margin-top: 33px;" type="date" id="arrivaldat" required class="form-inline"/>
        </div>
        </div>

        <div style="margin-left: 15px;" class="col-md-12">
        <div class="form-group">
        <label for="arrdatti e">Zeitpunkt der Ankunft</label>
        <input style="margin-top: 33px;" type="time" id="arrivaltime" required class="form-inline"/>
        </div>
        </div>

        </div>

        </div>

    </div>

      <div class="container5">
      <div class="dropdown">
        <h3>Wiederholung der Fahrt:</h3>
        <select id="repeat" name="repeat">
            <option value="1">Einmalig</option>
            <option value="2">Täglich</option>
            <option value="3">Wöchentlich</option>
            <option value="4">Monatlich</option>
        </select>
        </div>
        </div>
      
    <div class="container3">
        <h3>Weitere Angaben:</h3>
            <div class="row">
            <div class="col-md-3">
            <div class="form-group">
            <label for="Automarke">Automarke</label>
            <input style="width: 160px;" type="text" class="form-control" id="type" required placeholder="Automarke"></div>
            </div>

            <div class="col-md-3">
            <div class="form-group">
            <label for="Kennzeichen">Kennzeichen</label>
            <input style="width: 160px;" type="text" class="form-control" id="licence" required placeholder="z.B. PA-R-1997 "></div>
            </div>

            <div class="col-md-3">
            <div class="form-group">
            <label for="Farbe">Farbe</label>
            <input style="width: 160px;" type="text" class="form-control" id="color" required placeholder="Farbe"></div>
            </div>
            </div>

            <div class="row">
            <div class="col-md-3">
            <div class="form-group">
            <label for="Plätze">Plätze</label>
            <input style="width: 160px;" type="number" class="form-control" id="seats" required placeholder="Plätze" min="1" max="6"></div>
            </div>

            <div class="col-md-3">
            <div class="form-group">
            <label for="Gepäck">Gepäck</label>
            <input style="width: 160px;" type="number" class="form-control" id="bags" required placeholder="Gepäck" min="0" max="10"></div>
            </div>

            <div class="col-md-3">
            <div class="form-group">
            <label for="Preis/Km">Preis/Km (z.B.0.05)</label>
            <input style="width: 160px;" type="text" class="form-control" id="priceKm" required placeholder="0.05" min="0"></div>
            </div>
            </div>

            <div class="row">
             <div class="col-md-3">
            <div class="form-group">
            <label for="Preis/Gepäck">Preis/Gepäck</label>
            <input style="width: 180px;" type="text" class="form-control" id="priceBag" placeholder="Preis/Gepäck in Euro" min="0"></div>
            </div>
            </div>
          <button class="btn btn-success" id="saveButton" onclick="saveJourney()">Fahrt anbieten</button>

          </div>
          <div>
          </div>

        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAFtkAWeROn5POqzqjevKRYIo4cB0ZbZWw&libraries=places&callback=initAutocomplete"
        async defer></script>



      </body>
      </html>
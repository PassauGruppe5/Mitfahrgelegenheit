<!DOCTYPE html>
<html lang="de"
xmlns:th="http://www.thymeleaf.org">
    <head>
      <title>Fahrt_anbieten</title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
      
      <style>
      
          .container1{
            
              position: relative;
              margin-left: 150px;
              margin-right: 150px;
              
          }
          
          .container2{
              
              position: absolute;
              margin-left: 10px;
              width: 40%;
          }
          
          .container3{
              
              position: absolute;
              margin-top: 600px;
              margin-left: 10px;
              width: 40%;
          }
          
          .container4{
              
              position: absolute;
              margin-left: 10px;
              width: 40%;
              margin-top: 350px;
          }
          
           #logo{
              
             width:130px;
             height:50px;
             margin-top: 5px;
               
          }
          
          .navbar{
              
              margin-top: 10px;
              
          }
          
          #map {
              
              height: 100%;
              float: right;
              margin-right: 300px;
              border: solid black;
              margin-top: 20px;
              
          }
    
          .input{
              
              border-radius: 10px;
              
          }
          
          .form-control{
              
              width: 100%;
              
          }
          
          h3{
              
          }
          
          #departure{
              
              border-radius: 10px;
              width: 140px;
          }
          
          #arrival{
              
              border-radius: 10px;
              width: 140px;
          }
      
      </style>
      
      <link type="text/css" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script>

              var places = {};
              var autocompletes = {};
              var journey = {};
              function initAutocomplete() {

                  var directionsService = new google.maps.DirectionsService;
                  var directionsDisplay = new google.maps.DirectionsRenderer;
                  var map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 5,
                    center: {lat: 51.133481, lng: 10.018343},
                    streetViewControl: false,
                    fullscreenControl: false,
                    mapTypeControlOptions: { mapTypeIds: [] },
                    styles: [
                              {
                                "elementType": "geometry",
                                "stylers": [
                                  {
                                    "color": "#ebe3cd"
                                  }
                                ]
                              },
                              {
                                "elementType": "labels.text.fill",
                                "stylers": [
                                  {
                                    "color": "#523735"
                                  }
                                ]
                              },
                              {
                                "elementType": "labels.text.stroke",
                                "stylers": [
                                  {
                                    "color": "#f5f1e6"
                                  }
                                ]
                              },
                              {
                                "featureType": "administrative",
                                "elementType": "geometry.stroke",
                                "stylers": [
                                  {
                                    "color": "#c9b2a6"
                                  }
                                ]
                              },
                              {
                                "featureType": "administrative.land_parcel",
                                "elementType": "geometry.stroke",
                                "stylers": [
                                  {
                                    "color": "#dcd2be"
                                  }
                                ]
                              },
                              {
                                "featureType": "administrative.land_parcel",
                                "elementType": "labels.text.fill",
                                "stylers": [
                                  {
                                    "color": "#ae9e90"
                                  }
                                ]
                              },
                              {
                                "featureType": "landscape.natural",
                                "elementType": "geometry",
                                "stylers": [
                                  {
                                    "color": "#dfd2ae"
                                  }
                                ]
                              },
                              {
                                "featureType": "poi",
                                "elementType": "geometry",
                                "stylers": [
                                  {
                                    "color": "#dfd2ae"
                                  }
                                ]
                              },
                              {
                                "featureType": "poi",
                                "elementType": "labels.text.fill",
                                "stylers": [
                                  {
                                    "color": "#93817c"
                                  }
                                ]
                              },
                              {
                                "featureType": "poi.park",
                                "elementType": "geometry.fill",
                                "stylers": [
                                  {
                                    "color": "#a5b076"
                                  }
                                ]
                              },
                              {
                                "featureType": "poi.park",
                                "elementType": "labels.text.fill",
                                "stylers": [
                                  {
                                    "color": "#447530"
                                  }
                                ]
                              },
                              {
                                "featureType": "road",
                                "elementType": "geometry",
                                "stylers": [
                                  {
                                    "color": "#f5f1e6"
                                  }
                                ]
                              },
                              {
                                "featureType": "road.arterial",
                                "elementType": "geometry",
                                "stylers": [
                                  {
                                    "color": "#fdfcf8"
                                  }
                                ]
                              },
                              {
                                "featureType": "road.highway",
                                "elementType": "geometry",
                                "stylers": [
                                  {
                                    "color": "#f8c967"
                                  }
                                ]
                              },
                              {
                                "featureType": "road.highway",
                                "elementType": "geometry.stroke",
                                "stylers": [
                                  {
                                    "color": "#e9bc62"
                                  }
                                ]
                              },
                              {
                                "featureType": "road.highway.controlled_access",
                                "elementType": "geometry",
                                "stylers": [
                                  {
                                    "color": "#e98d58"
                                  }
                                ]
                              },
                              {
                                "featureType": "road.highway.controlled_access",
                                "elementType": "geometry.stroke",
                                "stylers": [
                                  {
                                    "color": "#db8555"
                                  }
                                ]
                              },
                              {
                                "featureType": "road.local",
                                "elementType": "labels.text.fill",
                                "stylers": [
                                  {
                                    "color": "#806b63"
                                  }
                                ]
                              },
                              {
                                "featureType": "transit.line",
                                "elementType": "geometry",
                                "stylers": [
                                  {
                                    "color": "#dfd2ae"
                                  }
                                ]
                              },
                              {
                                "featureType": "transit.line",
                                "elementType": "labels.text.fill",
                                "stylers": [
                                  {
                                    "color": "#8f7d77"
                                  }
                                ]
                              },
                              {
                                "featureType": "transit.line",
                                "elementType": "labels.text.stroke",
                                "stylers": [
                                  {
                                    "color": "#ebe3cd"
                                  }
                                ]
                              },
                              {
                                "featureType": "transit.station",
                                "elementType": "geometry",
                                "stylers": [
                                  {
                                    "color": "#dfd2ae"
                                  }
                                ]
                              },
                              {
                                "featureType": "water",
                                "elementType": "geometry.fill",
                                "stylers": [
                                  {
                                    "color": "#b9d3c2"
                                  }
                                ]
                              },
                              {
                                "featureType": "water",
                                "elementType": "labels.text.fill",
                                "stylers": [
                                  {
                                    "color": "#92998d"
                                  }
                                ]
                              }
                            ]
                  });
                  directionsDisplay.setMap(map);

                var inputs = document.getElementsByClassName('input');

                var options = {
                  componentRestrictions: {country: 'de'}
                };

                function getRoute () {
                  // Get the place details from the autocomplete object.
                  var place = autocompletes[this.inputId].getPlace();

                  places[this.inputId] = place;

                  if (places.destination && places.origin){
                      var waypoints = [];

                      Object.keys(places).filter(key => (key !== 'destination' && key !== 'origin')).map(key => {
                          waypoints.push({
                            location: getLatLng(places[key]),
                            stopover: true
                          })
                      });


                      directionsService.route({
                          origin: getLatLng(places.origin),
                          destination: getLatLng(places.destination),
                          waypoints: waypoints,
                          optimizeWaypoints: false,
                          travelMode: 'DRIVING'
                        }, function(response, status) {
                          if (status === 'OK') {
                            journey.route = JSON.stringify(response)
                            journey.legs = JSON.stringify(response.routes[0].legs);
                            directionsDisplay.setDirections(response);
                          } else {
                            window.alert('Directions request failed due to ' + status);
                          }
                        });
                  }

                };


                for (var i = 0; i < inputs.length; i++) {
                  var autocomplete = new google.maps.places.Autocomplete(inputs[i], options);
                  autocomplete.inputId = inputs[i].id;
                  autocomplete.addListener('place_changed', getRoute);
                  autocompletes[autocomplete.inputId] = autocomplete;
                }

              }

              function getLatLng(place) {
                  var lat = place.geometry.location.lat();
                  var lng = place.geometry.location.lng();
                  var LatLng = new google.maps.LatLng(lat, lng);
                  return LatLng;
              }

              function saveJourney(){
                journey.seats = $("#seats").val();
                journey.bags = $("#bags").val();
                journey.priceKm = $("#priceKm").val();
                journey.priceBag = $("#priceBag").val();
                journey.departure = $("#departure").val();
                journey.arrival = $("#arrival").val();
                journey.origin = $("#origin").val();
                journey.destination = $("#destination").val();
                journey.matchRepeat =$("#repeat").val();

                console.log(journey)
                $.ajax({
                    url: "/journey/create",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(journey),
                    success: function(data, status){
                    }.bind(this),
                    error: function(xhr, error) {
                      console.log(error);
                    }
                });
              };


            </script>
      
      </head>
  <body>
      
      <div class="container1">
          
          <nav class="navbar navbar-expand-md navbar-dark bg-dark" role="navigation">
  <div class="container-fluid">
    <!-- Titel und Schalter werden für eine bessere mobile Ansicht zusammengefasst -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Navigation ein-/ausblenden</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
     <a href="/" class="navbar-left"><img id="logo" th:src="@{/images/logo.png}"/></a>
    </div>

    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="/"><span class="glyphicon glyphicon-search" aria-hidden="true"></span> Suche</a></li>
        <li><a href="/journey/create"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Fahrt anbieten</a></li>
        <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Menü <span class="caret"></span></a>
          <ul class="dropdown-menu navbar-right">
            <li><a th:href="@{'/profile/show/profile?id='+${user.id}}+'#offered'"><span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span>   Angebotene Fahrten</a></li>
            <li><a th:href="@{'/profile/show/profile?id='+${user.id}}+'#booked'"><span class="glyphicon glyphicon-barcode" aria-hidden="true"></span>   Gebuchte Fahrten</a></li>
            <li role="separator" class="divider"></li>
            <li><a th:href="@{'/profile/show/profile?id='+${user.id}}+'#profil'"><span class="glyphicon glyphicon-user" aria-hidden="true"></span>   Profil</a></li>
            <li><a th:href="@{'/profile/show/profile?id='+${user.id}}+'#balance'"><span class="glyphicon glyphicon-piggy-bank" aria-hidden="true"></span>   Verfügbares Guthaben</a></li>
            <li><a th:href="@{'/profile/show/profile?id='+${user.id}}+'#rating'"><span class="glyphicon glyphicon-star" aria-hidden="true"></span>   Bewertung</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="/logout"><span class="glyphicon glyphicon-home" aria-hidden="true"></span>   Ausloggen</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
  </nav>
</div>
      <hr>
    <div class="container2">
    <h3>Routenplanung:</h3>
        <div class="form-group">
        <label for="Startpunkt">Startpunkt</label>
        <input type="text" class="input form-control" id="origin" required placeholder="Startpunkt">
        </div>
        <div class="form-group">
        <label for="Startpunkt">Zwischenstop 1</label>
        <input type="text" class="input form-control" id="stop1" placeholder="Zwischenstop 1">
        </div>
        <div class="form-group">
        <label for="Startpunkt">Zwischenstop 2</label>
        <input type="text" class="input form-control" id="stop2" placeholder="Zwischenstop 2">
        </div>
        <div class="form-group">
        <label for="Startpunkt">Endziel</label>
        <input type="text" class="input form-control" id="destination" required placeholder="Endziel">
        </div>
    </div>
      
    <div id="map" style="margin-left: 10px; height: 600px; width: 600px"></div>
      
    <div class="container4">
    <h3>Zeitplanung:</h3>
        <div class="form-group">
        <label for="depdat">Datum der Abfahrt</label>
        <input type="datetime-local" id="departure" class="form-inline"/>
        </div>
        <div class="form-group">
        <label for="arrdat">Datum der Ankunft</label>
        <input type="datetime-local" id="arrival" class="form-inline"/>
        </div>
        <div class="dropdown">
        <h3>Wiederholung der Fahrt:</h3>
        <select id="repeat" name="repeat">
            <option value="1">Einmalig</option>
            <option value="2">Täglich</option>
            <option value="3">Wöchentlich</option>
            <option value="4">Monatlich</option>
        </select>
        </div>
    </div>
      
    <div class="container3">
    <h3>Weitere Angaben:</h3>
                <input id="seats" placeholder="Pätze" type="number" min="1" required/>
                <input id="bags" placeholder="Gepäck" type="number" min="0" required/>
                <input id="priceKm" placeholder="Preis/Km" type="number" min="0" required/>
                <input id="priceBag" placeholder="Preis/Km (Gepäck)" type="number" min="0" required/>
                <button id="saveButton" onclick="saveJourney(); window.location.href='../../../../..' ">Speichern</button>
              </div>
      
    <div>
        
        
    </div>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAFtkAWeROn5POqzqjevKRYIo4cB0ZbZWw&libraries=places&callback=initAutocomplete"
    async defer></script>
        
   
           
  </body>
  </html>